{% extends 'layout.html' %}

{% block title %}Review Paper: {{ review_assignment.paper.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-8 mt-10 border border-gray-100">

    <div class="flex justify-between items-center mb-6 border-b pb-4">
        <h1 class="text-3xl font-bold text-gray-800">Review Form</h1>
        <a href="{{ url_for('reviewer.dashboard', conf_id=conference_id) }}" class="text-sm text-gray-500 hover:text-indigo-600 transition duration-150 flex items-center">
            <i class="fas fa-arrow-left mr-1"></i> Back to Dashboard
        </a>
    </div>

    <div class="bg-gray-50 p-5 rounded-md mb-6 border">
        <h2 class="text-xl font-extrabold text-indigo-700 mb-1">{{ review_assignment.paper.title }}</h2>
        <p class="text-sm text-gray-600 mb-3">
            <strong>Track:</strong> {{ review_assignment.paper.track.name if review_assignment.paper.track else 'General' }} |
            <strong>Submission Date:</strong> {{ review_assignment.paper.created_at.strftime('%Y-%m-%d') }}
        </p>
        <div class="space-y-4 pt-3">
            <div>
                <p class="text-sm text-gray-700 font-medium border-b pb-1">Abstract:</p>
                <p class="text-justify text-sm text-gray-600 italic bg-white p-3 rounded-md border mt-1">{{ review_assignment.paper.abstract or "Abstract not available." }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-700 font-medium">Keywords:</p>
                <p class="text-sm text-gray-600 mt-1 ml-3">{{ review_assignment.paper.keywords or 'None provided.' }}</p>
            </div>
            <div>
                 <p class="text-sm text-gray-700 font-medium">Blind Copy File:</p>
                 <a href="{{ url_for('reviewer.download_paper', conf_id=conference_id, paper_id=review_assignment.paper.paper_id) }}"
                    class="mt-1 inline-flex items-center text-sm font-semibold text-blue-600 hover:text-blue-800 transition duration-150">
                     <i class="fas fa-file-download mr-1"></i> Download File ({{ review_assignment.paper.blind_paper_file }})
                 </a>
            </div>
        </div>
    </div>
    {% if is_completed %}
        <div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg text-center mb-6">
            <p class="font-bold text-lg">âœ… REVIEW SUBMITTED</p>
            <p class="text-sm mt-1">
                Your review was submitted on <strong>{{ review_assignment.created_at.strftime('%Y-%m-%d at %I:%M %p') }}</strong>.
            </p>
        </div>
    {% endif %}

    <form method="POST" action="{{ url_for('reviewer.view_review_form', conf_id=conference_id, review_id=review_assignment.review_id) }}" class="space-y-6">

        {% set disabled_attr = 'disabled' if is_locked else '' %}
        {% set disabled_class = 'bg-gray-200' if is_locked else '' %}

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 border-b pb-4">

            <div class="md:col-span-1">
                <label for="score" class="block text-sm font-bold text-gray-700">Technical Score (1-5)</label>
                <input type="number" id="score" name="score" min="1" max="5" required {{ disabled_attr }}
                       value="{{ review_assignment.score or '' }}"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border {{ disabled_class }}">
            </div>

            <div class="md:col-span-2">
                <label for="recommendation" class="block text-sm font-bold text-gray-700">Final Recommendation</label>
                <select id="recommendation" name="recommendation" required {{ disabled_attr }}
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border {{ disabled_class }}">
                    <option value="">-- Select Recommendation --</option>
                    {% for rec in recommendations %}
                        <option value="{{ rec.name }}"
                                {% if review_assignment.recommendation and review_assignment.recommendation.name == rec.name %} selected {% endif %}>
                            {{ rec.name.replace('_', ' ').title() }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div>
            <label for="comments_to_author" class="block text-sm font-bold text-gray-700">Comments to Author (Required for Feedback)</label>
            <textarea id="comments_to_author" name="comments_to_author" rows="8" required {{ disabled_attr }}
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border {{ disabled_class }}">{{ review_assignment.comments_to_author or '' }}</textarea>
        </div>

        <div>
            <label for="comments_to_organiser" class="block text-sm font-bold text-gray-700">Confidential Comments to Organizer (Optional)</label>
            <textarea id="comments_to_organiser" name="comments_to_organiser" rows="4" {{ disabled_attr }}
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border {{ disabled_class }}">{{ review_assignment.comments_to_organiser or '' }}</textarea>
        </div>


        <div class="pt-4 border-t flex justify-end">
            {% if is_locked %}
                <a href="{{ url_for('reviewer.view_review_form', conf_id=conference_id, review_id=review_assignment.review_id, edit='true') }}"
                   class="inline-flex justify-center py-3 px-6 border border-transparent shadow-lg text-base font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 transition duration-150">
                    <i class="fas fa-unlock mr-2"></i> Edit Review
                </a>
            {% else %}
                <button type="submit" class="inline-flex justify-center py-3 px-6 border border-transparent shadow-lg text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition duration-150">
                    <i class="fas fa-save mr-2"></i> Save Review
                </button>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}